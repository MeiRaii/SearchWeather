<!doctype html>
<html lang="en">
     <head>
         <meta charset="UTF-8">
         <meta name="Generator" content="®">
         <meta name="Author" content="">
         <meta name="Keywords" content="">
         <meta name="Description" content="">
         <title>Search+Weather</title>
         <style>
             body,div,ul,li,ol,p,span,h1,h2,h3,h4,h5,h6,a,img,table,form{margin:0;padding:0;}
             body{font:16px/1.5 "Microsoft Yahei" ;}
             ul{list-style:none;}
             a{text-decoration:none;}
             .clearfix:after{content:''; display:block; clear:both;}
             /*头部样式*/
             #head{
                 z-index:999;
                 position: relative;
                 min-width: 1000px;
                 width: 100%;
                 height: 32px;
                 border-bottom:1px solid #eee;
             }
             #head em{
                 font-style:normal;
             }
             #weather{
                 float: left;
                 height: 20px;
                 margin: 7px 0 0 15px;
                 line-height: 20px;
                 text-align: center;
                 font-size:12px;
                 cursor: pointer;
             }
             .show_weather{
                 display: inline-block;
                 height: 20px;
                 white-space: nowrap;
             }
             .show_weather span{
                 display: inline-block;
                 height: 20px;
                 vertical-align: bottom;
             }

             .show_icon{
                 margin-right:9px;
             }
             .weather_icon{
                 width:22px;
                 height:22px;
                 background: url(http://app1.showapi.com/weather/icon/day/01.png) no-repeat center / 100%;
             }
             #show_pollution{
                 display: inline-block;
                 height: 20px;
             }
             .show_pollution_name{
                 margin-right: 7px;
                 font-weight: bold;
                 color: #38f;
             }
             .show_pollution_num,.show_vertical{
                 margin-right: 7px;
             }

             #s_icons{
                 height:32px;
                 font-size:12px;
             }
             #s_icons a{
                 position: relative;
                 display: inline-block;
                 height: 32px;
                 margin-right: 19px;
                 text-decoration: underline;
                 text-shadow: none;
                 outline: none;
                 line-height: 32px;
                 color: #555;
             }

             #head_menu{
                 position: absolute;
                 top:0;
                 right:0;
                 height:100%;
                 font-size: 13px;
                 color:#999;
             }
             #head_menu a{
                 float:left;
                 display: inline-block;
                 position: relative;
                 height: 32px;
                 margin-left: 19px;
                 text-decoration: underline;
                 text-shadow: none;
                 outline: none;
                 line-height: 32px;
                 font-weight: bold;
                 color: #555;
             }
             #setting_nav{
                 display: none;
                 position: absolute;
                 top:32px;
                 right:84px;
                 width: 70px;
                 border:1px solid #ddd;
                 box-shadow: 0 0 5px #ddd;
                 font-size: 12px;
             }
             #setting_nav a{
                 display: block;
                 width: 100%;
                 height:26px;
                 margin:0;
                 text-decoration: none;
                 text-align: center;
                 line-height: 26px;
                 font-weight: normal;
                 color:#333;
             }

             #setting_nav a:hover{
                 color:#fff;
                 background: #398bfb;
             }
             #setting_nav .arrow em,#setting_nav .arrow i{
                 display: block;
                 position: absolute;
                 top:-10px;
                 left:0px;
                 right: 0px;
                 margin:auto;
                 width: 0px;
                 height: 0px;
                 border:5px solid transparent;
             }
             #setting_nav .arrow em{
                 border-bottom-color: #d8d8d8;
             }
             #setting_nav .arrow i{
                 top:-9px;
                 border-bottom-color: #fff;
             }
             #setting{
                 float:left;
             }
             #head_menu #setting a{
                 font-weight: normal;
             }
             #setting:hover #setting_nav{
                 display: block;
             }
             #head_menu .more_pro{
                 width:86px;
                 height: 32px;
                 text-decoration: none;
                 text-align: center;
                 line-height: 32px;
                 font-size: 13px;
                 color:#fff;
                 background: #398bfb;
             }

             /*百度logo样式*/
             #image{
                 position: relative;
                 width:270px;
                 height: 129px;
                 margin:40px auto;
             }
             #image a{
                 position: absolute;
                 top:0;
                 left: 0;
                 width: 100%;
                 height: 100%;
             }

             /*搜索框样式*/
             #form{
                 position: relative;
                 width:641px;
                 height: 40px;
                 margin:30px auto;
             }
             #inp{
                 position: relative;
                 width:480px;
                 height:26px;
                 padding: 6px 48px 6px 7px;
                 border-top: 1px solid #999 !important;
                 border-left: 1px solid #999 !important;
                 border-bottom: 1px solid #b3b3b3 !important;
                 line-height: 26px;
                 text-indent:10px;
                 font-size: 14px;
             }

             /*搜索信息显示样式*/
             #list{
                 width:536px;
                 border:1px solid #ccc;
                 border-top:none;
                 /*box-shadow: 1px 1px 2px #999;*/
             }
             #list li{
                 height:30px;
                 line-height:30px;
                 text-indent: 10px;
             }
             #list li a{
                 display:block;
                 height:100%;
                 font-size:14px;
                 color:#000;
                 cursor: default;
             }
             #list li a:hover,#list li a.active{
                 background:#ccc;
             }

             /*百度一下按钮样式*/

             #btn{
                 position: absolute;
                 top:0px;
                 right:0px;
                 width:104px;
                 height:40px;
                 border:none;
                 text-align: center;
                 line-height:35px;
                 font-size:16px;
                 color:#fff;
                 background:#3385ff;
                 cursor: pointer;
             }
             #btn:hover{
                 background: #2e76e3;
             }
         </style>
     </head>
     <body>
        <!--头部-->
        <div id="head">
            <div id="weather">
                <div class="show_weather">
                    <span class="show_cityname"></span>
                    <span class="show_icon">
                        <span class="weather_icon"></span>
                        <em class="show_icon_temp"></em>
                    </span>
                </div>
                <div id="show_pollution">
                    <span class="show_airParm">
                        <em class="show_pollution_name"></em>
                        <em class="show_pollution_num"></em>
                    </span>
                    <span class="show_vertical">|</span>
                </div>
            </div>
            <div id="s_icons">
                 <a href="#" class="s_skin" title="换肤">
                     <span class="title">换肤</span>
                 </a>
                 <a href="#" class="s_msg" title="消息">
                     <span class="title">消息</span>
                 </a>
             </div>
            <div id="head_menu">
                <a href="http://news.baidu.com" target="_blank" class="mnav">新闻</a>
                <a href="http://www.hao123.com" target="_blank" class="mnav">hao123</a>
                <a href="http://maps.baidu.com" target="_blank" class="mnav">地图</a>
                <a href="http://v.baidu.com" target="_blank" class="mnav">视频</a>
                <a href="http://tieba.baidu.com" target="_blank" class="mnav">学术</a>
                <a href="http://xueshu.baidu.com" target="_blank" class="mnav">贴吧</a>
                <div id="setting">
                    <a href="javascript:;" target="_blank" class="mnav" >设置</a>
                    <div id="setting_nav">
                        <span class="arrow"><em></em><i></i></span>
                        <a href="javascript:;">搜索设置</a>
                        <a href="//www.baidu.com/gaoji/advanced.html" target="_blank">高级搜索</a>
                        <a href="javascript:;">关闭预测</a>
                        <a href="http://i.baidu.com/my/history?from=ps" target="_blank">搜索历史</a>
                    </div>
                </div>
                <a href="http://www.baidu.com/more/" class="more_pro" target="_blank"> 更多产品</a>
            </div>
        </div>
        <!--百度logo-->
        <div id="image">
             <image src="https://www.baidu.com/img/bd_logo1.png?where=super" width="270" height="129"></image>
             <a style="cursor:pointer;outline:none;" href="//www.baidu.com/s?wd=%E4%BB%8A%E6%97%A5%E6%96%B0%E9%B2%9C%E4%BA%8B&amp;tn=SE_Pclogo_6ysd4c7a&amp;sa=ire_dl_gh_logo&amp;rsv_dl=igh_logo_pc" target="_blank" title="点击一下，了解更多"></a>
        </div>
        <!--搜索框-->
        <div id="form">
            <input type="text" id="inp">
            <ul id="list">
                <!--<li>你好</li>-->
                <!--<li>aaaaa</li>-->
            </ul>
            <input id="btn" type="button" value="百度一下">
        </div>
        <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
        <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.4.6&key=a29ee83f1e86e70461ce7f6b9d263427&plugin=AMap.CitySearch"></script>
        <!--<script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>-->
        <script>

            var oInp = document.getElementById("inp"),
                oList = document.getElementById("list"),
                oLi = oList.children,
                oSea = document.getElementById("btn");

            var aWeather = document.getElementById("weather"),
                aShow_cityname = document.getElementsByClassName("show_cityname")[0],
                aWeather_icon = document.getElementsByClassName("weather_icon")[0],
                aShow_icon_temp = document.getElementsByClassName("show_icon_temp")[0],
                aShow_pollution_name = document.getElementsByClassName("show_pollution_name")[0],
                aShow_pollution_num = document.getElementsByClassName("show_pollution_num")[0];

            //页面 一刷新input框就获取焦点
            oInp.focus();
            //input框中内容发生改变的事件
            oInp.oninput = eFn;
            //input框获得焦点事件
            oInp.onfocus = function () {
                eFn.call(this);
                this.sVal = this.value;
            }
            //失去焦点事件
            oInp.onblur = function () {
                setTimeout(function () {
                    oList.innerHTML = "";
                },200);
            }

            //键盘点击抬起事件
            oInp.onkeyup = function (ev) {
                ev = ev || window.event;
                var val = this.value;
                var keyCode = ev.keyCode;
                if(keyCode !== 40 && keyCode !== 38){
                    this.sVal = val;
                    this.index = 0;
                }
                if(keyCode === 13){
                    console.log(111);
                    val ? window.location.href = "https://www.baidu.com/s?wd="+val : window.location.href = "https://www.baidu.com";
                    this.blur();
                }else if(keyCode === 40 || keyCode === 38){
                    UpOrDown.call(this,keyCode);
                    //阻止默认事件
                    ev.preventDefault && ev.preventDefault();
                    return false;
                }

            }

            //搜索点击事件
            oSea.onclick = function () {
                console.log("baidu");
                var val = oInp.value;
                val ? window.location.href = "https://www.baidu.com/s?wd="+val :"";
            }
            //键盘上下键点击函数
            function UpOrDown(keyCode) {
                for(var i=0; i<oLi.length; i++){
                    oLi[i].children[0].className = "";
                }
                if(keyCode === 38){
                    this.index--;
                    if(this.index<0) this.index = oLi.length;
                }else{
                    this.index ++;
                    this.index %= oLi.length + 1;
                }
                if(this.index){
                    this.value = oLi[this.index-1].children[0].innerHTML;
                    oLi[this.index-1].children[0].className = "active";
                }else{
                    this.value = this.sVal;
                }

            }

            //请求jsonp的事件函数
            function eFn() {
                var val = this.value;
                //上下键获取内容的编号
                this.index=0;
                if(val) {
                    var scr = document.createElement("script");
                    scr.src = "https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd="+val+"&cb=zg&_=1521260069116";
                    document.body.appendChild(scr);

                    scr.onload = function () {
                        document.body.removeChild(scr);
                    }
                }else{
                    oList.innerHTML = "";
                }
            }

            function zg( json ) {
                //清理ul里面的内容
                oList.innerHTML = "";
                console.log(json);
                var data = json.s;

                for(var i=0,length=4; i<length; i++){
                    var wd = data[i];
                    var aLi = document.createElement("li");
                    aLi.innerHTML = "<a target='_self' href='https://www.baidu.com/s?wd="+wd+"'>"+ wd +"</a>";
                    aLi.onclick = function () {
                        oInp.value = this.children[0].innerHTML;
                    }
                    if(wd){
                        oList.appendChild(aLi);
                    }

                }
            }


            /*天气部分*/
            //获取用户所在城市信息
            ~function showCityInfo() {
                //实例化城市查询类
                var citysearch = new AMap.CitySearch();
                //自动获取用户IP，返回当前城市
                citysearch.getLocalCity(function(status, result) {
                    if (status === 'complete' && result.info === 'OK') {
                        if (result && result.city && result.bounds) {
                            var cityinfo = result.city;//长沙市  要转换成长沙
                            cityinfo = cityinfo.substring(0,cityinfo.length-1);
                            //当获取到地点时再执行获取天气函数
                            getWeather(cityinfo);
                        }
                    } else {
                        console.log(result.info);
                    }
                });
            }();

            function formatterDateTime() {
                var date=new Date()
                var month=date.getMonth() + 1
                var datetime = date.getFullYear()
                    + ""// "年"
                    + (month >= 10 ? month : "0"+ month)
                    + ""// "月"
                    + (date.getDate() < 10 ? "0" + date.getDate() : date
                        .getDate())
                    + ""
                    + (date.getHours() < 10 ? "0" + date.getHours() : date
                        .getHours())
                    + ""
                    + (date.getMinutes() < 10 ? "0" + date.getMinutes() : date
                        .getMinutes())
                    + ""
                    + (date.getSeconds() < 10 ? "0" + date.getSeconds() : date
                        .getSeconds());
                return datetime;

            }
            function getWeather(cityinfo) {
                $.ajax({
                    type: 'post',
                    url: 'http://route.showapi.com/9-2',
                    dataType: 'json',
                    data: {
                        "showapi_timestamp": formatterDateTime(),
                        "showapi_appid": '62379', //这里需要改成自己的appid
                        "showapi_sign": 'b8a34df2796c4f68a5be6641c86fd4dc',  //这里需要改成自己的应用的密钥secret
                        "area":cityinfo,
                        "needMoreDay":"1", //是否需要返回7天数据中的后4天。
                        "needIndex":"1",//是否需要返回指数数据
                    },

                    error: function(XmlHttpRequest, textStatus, errorThrown) {
                        alert("操作失败!");
                    },
                    success: function(result) {
                        success_weather(result); //console变量在ie低版本下不能用
                    }
                });
            };

            function success_weather(data) {
                //console.log(data.showapi_res_body);
                var wea = data.showapi_res_body;
                aShow_cityname.innerHTML = wea.cityInfo.c3 + ':';//城市名
                aWeather_icon.style.background = 'url('+wea.now.weather_pic+') no-repeat center/100%';//天气图片
                aShow_icon_temp.innerHTML = wea.now.temperature + '℃';//温度
                aShow_pollution_name.innerHTML = wea.now.aqiDetail.quality;//空气质量
                aShow_pollution_num.innerHTML = wea.now.aqiDetail.pm10;//颗粒物（粒径小于等于10μm）1小时平均

                aWeather.onclick = function () {
                    //console.log(wea);
                    var val = wea.cityInfo.c3+'天气预报';
                    window.location.href = "https://www.baidu.com/s?wd="+val;
                }

            }

        </script>
     </body>
</html>
